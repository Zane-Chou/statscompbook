\mainmatter

# 零基础入手 R  {#R}




## 介绍

本书使用 R 语言。R 是什么呢？在 R 的[官网](http://cran.r-project.org/)上是这么描述的：

> "... a freely available language and environment for statistical computing and graphics which provides a wide variety of statistical and graphical techniques: linear and nonlinear modelling, statistical tests, time series analysis, classification, clustering, etc...."

所以 R 是免费的、几乎适用于任何操作系统的一种语言和环境。在 R 里可安装上千个包，几乎可以做任何你想做的事情，具体来讲，它主要用于统计计算和统计图，包括线性和非线性模型、统计检验、时间序列分析、分类、聚类等。我们推荐通过 Rstudio 使用 R。

#### 安装 R 和 RStudio {-}

在 R 中可以在控制台（console）执行所有命令，但是更方便的是写 R 脚本（scripts），这时需要一个编辑器（editor）。Rstudio 是一个 R 语言的集成开发环境（Integrated Development Environment，IDE），它因为集成了编辑、调试（debugging）、可视化、R Markdown、R Notebook 等强大功能、非常受 R 用户的欢迎。下面给出 R 和 Rstudio 的下载地址。

  1. [下载和安装 R。](http://cran.r-project.org/)
  2. [下载和安装 RStudio。](http://bit.ly/rstudiodownload)


#### R 工作目录 {-}

当我们打开 R 或者 Rstudio 时，会有默认的工作目录，我们可以通过 `getwd()` 函数来看一下当前的工作目录。
```{r}
getwd()
```
开始任何一个任务之前，应该设置对应的工作目录，这可以通过 `setwd()` 来完成。当然可以在 R 的设置中也可以设置默认的初始工作目录。

#### 寻求帮助{-}

通过 `help(x)` 或者 `?x` 可以找到关于函数 `x` 的帮助文件。如果你忘记了一个命令或函数的具体名字，可以通过 `help.search('x')` 来找到有关 'x' 的所有命令



#### 安装 R 包 {-}
以 `ggplot2` 这个包为例，可以通过以下方式来安装。

- 先运行 RStudio，在“包”选项，点击“安装包”，并且安装 `ggplot2` 包。（请勾选“安装依赖包”选项）。

- 通过命令 `install.packages('ggplot2')`。


#### 本书中的 R 示例 {-}

我们通过类似下面阴影框的形式对本书中大部分例子提供了 R 代码。


```r
f <- expression(x^2 - 5)
df <- deriv(f, 'x', func = TRUE)
```

注意：有时候我们也假设同一章节中较前的 R 代码已被执行；所以最好在每个章节都按顺序执行所提供的 R 代码。 

就是这样！你现在应该准备好了！


## R 中的数据结构

R 是基于对象（objects）的，对象可以是 R 中的任何存在，如常数、数据结构、函数、图等。给定任何一个对象，可以通过 `str()` 来了解该对象的结构。R 中常用的基础数据结构有向量（vector）、列表（list）、矩阵（matrix）、数据框（data frame）等。

### 向量

向量是 R 中最基础的数据结构，向量分为逻辑型（logical）、整数型（integer）、数值型（Numeric）和字符型（character）几个类型。向量通过可以通过 `c()` 来创建，其中 “c”代表“combine”：
```{r, echo=TRUE}
num_x <- c(1.2, 4.5, 6)
int_x <- c(1L, 6L, 80L)
log_x <- c(TRUE, FALSE, T, F, F)
cha_x <- c('yanfei', 'feng')
cha_x
```
也可以通过比如以下方式直接生成一个向量：
```{r, echo=TRUE}
10:15
seq(from=1, to=10, by=3)
LETTERS[1:10]
rep(14, 10)
```

### 列表

列表和向量不同的是列表的元素可以是任何数据类型，列表可以通过函数 `list()` 来创建：
```{r, echo=TRUE}
l <- list(a = c(1, 2), b = "apple", c = list(1,2))
l
str(l)
```


### 矩阵

矩阵可以通过 `matrix()` 来创建：
```{r, echo=TRUE}
m <- matrix(c(1:6), 2, 3)
m
```
`dim()` 函数可以得到矩阵的维度，`t()` 可以得到矩阵的转置：
```{r, echo=TRUE}
dim(m)
t(m)
```
`rbind()` 和 `cbind()` 可以将两个矩阵按行或者按列合并： 
```{r, echo=TRUE}
n <- matrix(c(8:13), 2, 3)
rbind(m, n)
cbind(m, n)
```



### 数据框

数据框是 R 中最常用的数据结构，它是一种特殊的列表，这种列表中的每个元素长度都相等，因此它是兼有矩阵和列表的特性的二维结构。数据框可以通过 `data.frame()` 来创建：
```{r, echo=TRUE}
df <- data.frame(x = 1:10, y = letters[1:10])
str(df)
```
数据框也可以用 `rbind()` 和 `cbind()` 来合并。数据框的列可以为列表，如：
```{r, echo=TRUE}
df <- data.frame(x = 1:3)
df$y <- list(1:2, 1:3, 1:4)
df
```

### 子集提取

在 R 中有三种操作符可以提取不同数据结构的子集：

1. `[` 可以返回与原数据相同的数据类型。

2. `[[` 用于提取列表和数据框的子集。

3. `$` 可以依据变量名字提取列表和数据框的子集。

下面举例说明。

#### 提取向量的子集{-}

```{r, echo=TRUE}
x <- 1:10
x[1]  # 提取第一个元素
x[2]  # 提取第二个元素
x[c(1, 3, 4)] # 提取第1、3、4个元素
x[x > 2] # 提取大于2的元素
```

#### 提取列表的子集{-}

```{r, echo=TRUE}
x <- list(a = 1:4, b = letters[1:4], d = c(TRUE, FALSE))
x[[1]] # 提取x的第一个元素
x[['b']] # 提取x的b元素
x$a # 提取x的a元素
x[1] # [] 返回的数据结构和x相同，还是一个列表
x[c(1,3)]
```


#### 提取矩阵的子集{-}

```{r, echo=TRUE}
x <- matrix(1:6, 2, 3)
x[1, 2] # 提取x的第一行第二列
x[, 2] # 提取x的第二列
```

#### 提取数据框的子集{-}

```{r, echo=TRUE}
x <- data.frame(a = 1:10, b = letters[1:10], d = rnorm(10))
x$a # 提取x的a元素，相当于 x[[1]]
x[1] # 返回的还是数据框
head(x) # 查看x的前6行
tail(x) # 查看x的后6行
nrow(x) # x的行数
ncol(x) # x的列数
names(x) # x的列名
```



## R 中的数据输入输出

### R 中的数据输入

在 R 中数据输入的主要函数包括：

- 读取表格数据：`read.table()`, `read.csv()`。

- 读取文本数据：`readLines()`。

- 读取 R 脚本文件：`source()`。

- 读取 `.Rdata`：`load()`。

### R 中的数据输出

在 R 中数据输出的主要函数包括：

- 输出表格数据：`write.table()`, `write.csv()`。

- 输出文本数据：`writeLines()`。

- 输出 R 脚本文件：`dump()`。

- 输出 `.Rdata`：`save()`。


## R 中的控制语句

### `if-else`

`if-else` 条件语句是 R 中最常用的控制语句之一。简单的只有 `if` 的条件语句为：
```r
if(<condition>) {
  ## 执行一段代码
} 
## 继续
```
完整的 `if-else`  语句为：
```r
if(<condition>) {
  ## 执行 A 代码
} 
else {
  ## 执行 B 代码
}
```
我们举一个例子：
```{r, tidy=TRUE}
## Generate a uniform random number
x <- runif(1, 0, 10)  
if(x > 3) {
  y <- 10
} else {
  y <- 0
}
y
```

### `for` 循环

R 中 `for` 循环的写法为：
```r
for (x in vector) {
  ## 执行一段代码
} 
```
对于向量 `vector` 中的每一个元素 `x`，循环执行对应的代码。我们举一个例子：
```{r, tidy = TRUE}
x <- c("a", "b", "c", "d")
for(i in 1:4) {
  ## 打印 x 中的第 i 个元素
  print(x[i])  
}
```
在这个例子中，我们也可以避免使用索引（index）：
```{r, tidy = TRUE}
x <- c("a", "b", "c", "d")
for(x.ele in x) {
  print(x.ele)  
}
```
在高维的数据结构中，`for` 循环可以是嵌套的：
```{r, eval=FALSE, tidy=TRUE}
x <- matrix(1:9, 3, 3)
for(i in seq_len(nrow(x))) {
        for(j in seq_len(ncol(x))) {
                print(x[i, j])
        }   
}
```

### `while` 循环

`while` 循环从一个条件判断开始，如果判断为 `true`，循环执行循环主体，直到条件判断为 `false`停止循环：
```{r, eval=FALSE}
count <- 0
while(count < 10) {
  print(count)
  count <- count + 1
}
```


### 循环函数


虽然 `for` 和 `while` 循环非常有用，但是在命令行执行循环语句的过程尤其繁琐，这时我们可以使用循环函数，常用的循环函数有：

- `lapply()`：对一个列表的每一个元素循环执行一个函数。

- `sapply()`：和 `lapply` 相同，但是它可以简化输出结果。

- `apply()`：对一个数组的边（如一个矩阵的行或列）执行一个函数。

- `tapply()`：对于一个向量的子集执行一个函数。

- `mapply()`：和 `lapply` 相似，但它适用于多元情形。




## 如何写 R 函数

## 如何在 R 中作图


## 有关 R 的学习资源

如果你从来没有用过 R，可以学习 DataCamp 的免费在线课程 [“R入门”](http://bit.ly/dcintro2r)，这个课程不包括统计计算的内容，它只是教你R语言的基础。DataCamp 上还有 R 相关的[其他课程](https://www.datacamp.com/courses/tech:r)。 此外，[Coursera 上的 R 编程课程](https://www.coursera.org/learn/r-programming)也非常值得推荐。



